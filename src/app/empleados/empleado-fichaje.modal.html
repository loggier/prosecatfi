<ion-header>
  <ion-toolbar>
    <ion-title>Fichaje de Empleado</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Paso 1: Validación -->
  <div *ngIf="!isAuthenticated" class="auth-container">
    <div class="empleado-info">
      <ion-avatar>
        <img [src]="empleado?.foto ? server + empleado.foto : '../../assets/img/no-user.png'" alt="Foto empleado">
      </ion-avatar>
      <h2>{{empleado?.nombre}} {{empleado?.apellido}}</h2>
      <p>{{empleado?.email}}</p>
    </div>

    <ion-item>
      <ion-label position="stacked">Contraseña</ion-label>
      <ion-input type="password" [(ngModel)]="password"></ion-input>
    </ion-item>
    
    <ion-button expand="block" (click)="validatePassword()" class="auth-button">
      Validar
    </ion-button>
  </div>

  <!-- Paso 2: Fichaje (similar a check-in) -->
  <div *ngIf="isAuthenticated" class="fichaje-container">
    <!-- Selector de vehículo si hay disponibles -->
    <ion-item *ngIf="data_vehiculos?.Data?.length > 0">
      <ion-label>Vehículo</ion-label>
      <ion-select [(ngModel)]="vehiculo_select" placeholder="Seleccione Vehículo" cancel-text="Cancelar">
        <ion-select-option *ngFor="let item of data_vehiculos?.Data" [value]="item.id_vehiculo">
          {{item.nombre}}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Historial de asistencias -->
    <ion-row>
      <ion-col size="6" *ngFor="let item of asistencias?.Data">
        <ion-card class="card">
          <ion-row>
            <ion-col size="4">
              <div class="img-build">
                <ion-img src="../../assets/icon/building-svgrepo-com.svg" style="color: #fff; padding: 12px;"></ion-img>
              </div>
            </ion-col>
            <ion-col size="8">
              <p>{{item.tipo}}</p>
              <p>{{item.hora}}</p>
            </ion-col>
          </ion-row>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- Botón de fichaje -->
    <ion-row style="height: 50vh; width: 100%;">
      <ion-col size="12">
        <div class="circle">
          <ion-button (click)="confirm()" shape="round" class="fichaje-button">
            <ion-row>
              <ion-col size="3">
                <h1>
                  <ion-icon *ngIf="tipo=='Entrada'" name="cloud-upload"></ion-icon>
                  <ion-icon *ngIf="tipo!='Entrada'" name="cloud-download"></ion-icon>
                </h1>
              </ion-col>
              <ion-col size="9" style="text-align: center; text-transform: capitalize;">
                <h1>
                  Marcar<br>{{tipo}}
                </h1>
              </ion-col>
            </ion-row>
          </ion-button>
        </div>
        <p class="time-display">Hora Actual: <span>{{time}}</span></p>
      </ion-col>
    </ion-row>
  </div>
</ion-content>