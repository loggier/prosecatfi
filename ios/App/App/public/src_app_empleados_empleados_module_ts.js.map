{"version":3,"file":"src_app_empleados_empleados_module_ts.js","mappings":"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","sources":["./src/app/empleados/empleado-fichaje.modal.ts","./src/app/empleados/empleados-routing.module.ts","./src/app/empleados/empleados.module.ts","./src/app/empleados/empleados.page.ts"],"sourcesContent":["import { Component, Input } from '@angular/core';\nimport { ModalController, AlertController, ToastController, LoadingController } from '@ionic/angular';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport * as moment from 'moment-timezone';\nimport { Geolocation } from '@awesome-cordova-plugins/geolocation/ngx';\n\n@Component({\n  selector: 'app-empleado-fichaje-modal',\n  templateUrl: './empleado-fichaje.modal.html',\n  styleUrls: ['./empleado-fichaje.modal.scss']\n})\nexport class EmpleadoFichajeModal {\n  @Input() empleado: any;\n  \n  password = '';\n  isAuthenticated = false;\n  data_vehiculos = null;\n  vehiculo_select = null;\n  asistencias = null;\n  tipo = 'Entrada';\n  comentario = '';\n  loading = null;\n  latitud = 0;\n  longitud = 0;\n  time = null;\n  timer = null;\n  server = environment.server;\n\n  constructor(\n    private modalCtrl: ModalController,\n    private http: HttpClient,\n    private alertController: AlertController,\n    private geolocation: Geolocation,\n    private toastController: ToastController,\n    private loadingCtrl: LoadingController\n  ) {}\n\n  ngOnInit() {\n    this.time = moment().tz('Europe/Madrid').format('hh:mm');\n    this.updateTime();\n    this.updatePosition();\n  }\n\n  ionViewWillLeave() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n\n  dismiss() {\n    this.modalCtrl.dismiss();\n  }\n\n  async validatePassword() {\n    const loading = await this.loadingCtrl.create({\n      message: 'Validando...',\n      spinner: 'circles'\n    });\n    await loading.present();\n\n    const httpHeaders = new HttpHeaders({\n      'Content-Type': 'application/json'\n    });\n\n    try {\n      const response: any = await this.http.post(`${environment.url}/auth/login`, {\n        email: this.empleado.email,\n        password: this.password\n      }, { headers: httpHeaders }).toPromise();\n\n      if (response && response.access_token) {\n        this.isAuthenticated = true;\n        // Guardamos token temporalmente (no en localStorage)\n        this.empleado.access_token = response.access_token;\n        await this.loadDataVehiculo();\n        await this.loadDataAsistencia();\n      }\n      loading.dismiss();\n    } catch (error) {\n      loading.dismiss();\n      this.presentToastError('Contraseña incorrecta');\n    }\n  }\n\n  updateTime() {\n    this.timer = setInterval(() => {\n      this.time = moment().tz('Europe/Madrid').format('hh:mm');\n      this.updatePosition();\n    }, 10000);\n  }\n\n  updatePosition() {\n    this.geolocation.getCurrentPosition().then((resp) => {\n      this.latitud = resp.coords.latitude;\n      this.longitud = resp.coords.longitude;\n    }).catch((error) => {\n      this.presentToastError('Debe activar el GPS del dispositivo.');\n    });\n  }\n\n  async loadDataVehiculo() {\n    const httpHeaders = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${this.empleado.access_token}`\n    });\n\n    try {\n      const data: any = await this.http.post(`${environment.url}/process/dataVehiculos`, {}, \n        { headers: httpHeaders }).toPromise();\n      this.data_vehiculos = data;\n    } catch (error) {\n      console.error('Error loading vehiculos:', error);\n    }\n  }\n\n  async loadDataAsistencia() {\n    const fecha = moment().tz('Europe/Madrid').format('YYYY-MM-DD');\n    const httpHeaders = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${this.empleado.access_token}`\n    });\n\n    try {\n      const data: any = await this.http.post(`${environment.url}/process/dataAsistencias`, \n        { fecha }, { headers: httpHeaders }).toPromise();\n      \n      this.asistencias = data;\n      this.tipo = 'Entrada';\n      if (this.asistencias.Ultimo) {\n        if (this.asistencias.Ultimo.tipo == 'Entrada') {\n          this.tipo = 'Salida';\n        } else {\n          this.tipo = 'Entrada';\n        }\n      }\n    } catch (error) {\n      console.error('Error loading asistencias:', error);\n    }\n  }\n\n  async check() {\n    if (this.data_vehiculos?.Data?.length > 0 && this.vehiculo_select == null) {\n      this.presentToastError('Debe Seleccionar un Vehículo');\n      return false;\n    }\n\n    await this.showLoading();\n\n    const ultimo = this.asistencias.Ultimo ? this.asistencias.Ultimo.tipo : null;\n    const post = {\n      fecha: moment().tz('Europe/Madrid').format('YYYY-MM-DD'),\n      vehiculo: this.vehiculo_select ? this.vehiculo_select : null,\n      latitud: this.latitud,\n      longitud: this.longitud,\n      tipo: ultimo,\n      comentario: this.comentario\n    };\n\n    const httpHeaders = new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${this.empleado.access_token}`\n    });\n\n    try {\n      const data: any = await this.http.post(`${environment.url}/process/storeAsistencias`, \n        post, { headers: httpHeaders }).toPromise();\n      \n      if (data.id_direccion == null) {\n        await this.presentToast('Fichaje registrado fuera de fábrica.');\n      } else {\n        await this.presentToast('Fichaje registrado exitosamente.');\n      }\n\n      this.loading.dismiss();\n      this.modalCtrl.dismiss({ success: true });\n    } catch (error) {\n      this.loading.dismiss();\n      this.presentToastError('Error al registrar fichaje');\n    }\n  }\n\n  async confirm() {\n    this.comentario = '';\n    const alert = await this.alertController.create({\n      header: '¿Deseas Marcar ' + this.tipo + '?',\n      mode: 'ios',\n      buttons: [\n        {\n          text: 'SI',\n          role: 'confirm',\n          handler: (data) => {\n            this.comentario = data.comentario;\n            this.check();\n          }\n        },\n        {\n          text: 'NO',\n          role: 'cancel',\n          handler: () => { }\n        }\n      ],\n      inputs: [\n        {\n          name: 'comentario',\n          type: 'textarea',\n          placeholder: 'Agregar comentario'\n        }\n      ]\n    });\n\n    await alert.present();\n  }\n\n  async showLoading() {\n    this.loading = await this.loadingCtrl.create({\n      message: 'Marcando fichaje...',\n      spinner: 'circles'\n    });\n    await this.loading.present();\n  }\n\n  async presentToast(message: string) {\n    const toast = await this.toastController.create({\n      message: message,\n      duration: 2000\n    });\n    toast.present();\n  }\n\n  async presentToastError(message: string) {\n    const toast = await this.toastController.create({\n      message: message,\n      duration: 1000,\n      color: 'danger',\n      position: 'middle'\n    });\n    toast.present();\n  }\n}","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { EmpleadosPage } from './empleados.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: EmpleadosPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class EmpleadosPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { EmpleadosPageRoutingModule } from './empleados-routing.module';\n\nimport { EmpleadosPage } from './empleados.page';\nimport { EmpleadoFichajeModal } from './empleado-fichaje.modal';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    EmpleadosPageRoutingModule\n  ],\n  declarations: [EmpleadosPage, EmpleadoFichajeModal]\n})\nexport class EmpleadosPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport { NavController, ModalController } from '@ionic/angular';\nimport { EmpleadoFichajeModal } from './empleado-fichaje.modal';\n\n@Component({\n  selector: 'app-empleados',\n  templateUrl: './empleados.page.html',\n  styleUrls: ['./empleados.page.scss'],\n})\nexport class EmpleadosPage implements OnInit {\n\n  profile: any = null;\n  isSupervisor = false;\n  dataUser: any = null;\n  empleados: any[] = [];\n  server = environment.server;\n\n  constructor(\n    public api: HttpClient, \n    private navCtrl: NavController,\n    private modalCtrl: ModalController\n  ) { }\n\n  ngOnInit() {\n    if (localStorage.profile) {\n      this.profile = JSON.parse(localStorage.profile);\n    }\n\n    // Obtener datos completos del usuario desde el endpoint para asegurar que\n    // tenemos la información de cargos/is_empleado tal como en check-in\n    this.loadDataUser();\n  }\n\n  loadDataUser() {\n    const post = {};\n    const httpHeaders = new HttpHeaders()\n      .set('Content-Type', 'application/json')\n      .set('Authorization', `Bearer ${this.profile?.access_token}`);\n\n    this.api.post(`${environment.url}/process/dataUser`, post, { headers: httpHeaders }).subscribe((res: any) => {\n  this.dataUser = res;\n  const cargo = (res?.is_empleado?.cargos?.nombre || '').toString().toUpperCase();\n      this.isSupervisor = cargo === 'SUPERVISOR';\n      if (this.isSupervisor) {\n        this.loadEmpleados();\n      }\n    }, err => {\n      console.error('Error loading user data', err);\n    });\n  }\n\n  loadEmpleados() {\n    const post = {};\n    const httpHeaders = new HttpHeaders()\n      .set('Content-Type', 'application/json')\n      .set('Authorization', `Bearer ${this.profile?.access_token}`);\n\n    this.api.post(`${environment.url}/process/getDataEmpleados`, post, { headers: httpHeaders }).subscribe((res: any) => {\n      // Esperamos { empleados: [...] }\n      this.empleados = res?.empleados || [];\n    }, err => {\n      console.error('Error loading empleados', err);\n    });\n  }\n\n  goBack() {\n    this.navCtrl.back();\n  }\n\n  async registrarEmpleado(empleado: any) {\n    const modal = await this.modalCtrl.create({\n      component: EmpleadoFichajeModal,\n      componentProps: {\n        empleado\n      }\n    });\n\n    modal.onDidDismiss().then((result) => {\n      if (result.data?.success) {\n        // Actualizar lista de empleados después de un fichaje exitoso\n        this.loadEmpleados();\n      }\n    });\n\n    await modal.present();\n  }\n\n}\n"],"names":["Component","Input","ModalController","AlertController","ToastController","LoadingController","HttpClient","HttpHeaders","environment","moment","Geolocation","EmpleadoFichajeModal","constructor","modalCtrl","http","alertController","geolocation","toastController","loadingCtrl","server","ngOnInit","time","tz","format","updateTime","updatePosition","ionViewWillLeave","timer","clearInterval","dismiss","validatePassword","loading","create","message","spinner","present","httpHeaders","response","post","url","email","empleado","password","headers","toPromise","access_token","isAuthenticated","loadDataVehiculo","loadDataAsistencia","error","presentToastError","setInterval","getCurrentPosition","then","resp","latitud","coords","latitude","longitud","longitude","catch","data","data_vehiculos","console","fecha","asistencias","tipo","Ultimo","check","Data","length","vehiculo_select","showLoading","ultimo","vehiculo","comentario","id_direccion","presentToast","success","confirm","alert","header","mode","buttons","text","role","handler","inputs","name","type","placeholder","toast","duration","color","position","selector","template","NavController","EmpleadosPage","api","navCtrl","localStorage","profile","JSON","parse","loadDataUser","set","subscribe","res","dataUser","cargo","is_empleado","cargos","nombre","toString","toUpperCase","isSupervisor","loadEmpleados","err","empleados","goBack","back","registrarEmpleado","modal","component","componentProps","onDidDismiss","result"],"sourceRoot":"webpack:///"}